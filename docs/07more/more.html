<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.8">
<title>More Performance</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
/* Uncomment @import statement below to use as custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:transparent}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*::before,*::after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite::before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
*:not(pre)>code.nobreak{word-wrap:normal}
*:not(pre)>code.nowrap{white-space:nowrap}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}
.literalblock pre.nowrap,.literalblock pre.nowrap pre,.listingblock pre.nowrap,.listingblock pre.nowrap pre{white-space:pre;word-wrap:normal}
.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0;line-height:1.45}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #dddddf}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt,.quoteblock .quoteblock{margin:0 0 1.25em;padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;text-align:left;margin-right:0}
table.tableblock{max-width:100%;border-collapse:separate}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>thead>tr>.tableblock,table.grid-all>tbody>tr>.tableblock{border-width:0 1px 1px 0}
table.grid-all>tfoot>tr>.tableblock{border-width:1px 1px 0 0}
table.grid-cols>*>tr>.tableblock{border-width:0 1px 0 0}
table.grid-rows>thead>tr>.tableblock,table.grid-rows>tbody>tr>.tableblock{border-width:0 0 1px}
table.grid-rows>tfoot>tr>.tableblock{border-width:1px 0 0}
table.grid-all>*>tr>.tableblock:last-child,table.grid-cols>*>tr>.tableblock:last-child{border-right-width:0}
table.grid-all>tbody>tr:last-child>.tableblock,table.grid-all>thead:last-child>tr>.tableblock,table.grid-rows>tbody>tr:last-child>.tableblock,table.grid-rows>thead:last-child>tr>.tableblock{border-bottom-width:0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot,table.frame-ends{border-width:1px 0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd){background:#f8f8f7}
table.stripes-none tr,table.stripes-odd tr:nth-of-type(even){background:none}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{display:-ms-flexbox;display:-webkit-box;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media print,amzn-kf8{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<style>
/* Stylesheet for CodeRay to match GitHub theme | MIT License | http://foundation.zurb.com */
/*pre.CodeRay {background-color:#f7f7f8;}*/
.CodeRay .line-numbers{border-right:1px solid #d8d8d8;padding:0 0.5em 0 .25em}
.CodeRay span.line-numbers{display:inline-block;margin-right:.5em;color:rgba(0,0,0,.3)}
.CodeRay .line-numbers strong{color:rgba(0,0,0,.4)}
table.CodeRay{border-collapse:separate;border-spacing:0;margin-bottom:0;border:0;background:none}
table.CodeRay td{vertical-align: top;line-height:1.45}
table.CodeRay td.line-numbers{text-align:right}
table.CodeRay td.line-numbers>pre{padding:0;color:rgba(0,0,0,.3)}
table.CodeRay td.code{padding:0 0 0 .5em}
table.CodeRay td.code>pre{padding:0}
.CodeRay .debug{color:#fff !important;background:#000080 !important}
.CodeRay .annotation{color:#007}
.CodeRay .attribute-name{color:#000080}
.CodeRay .attribute-value{color:#700}
.CodeRay .binary{color:#509}
.CodeRay .comment{color:#998;font-style:italic}
.CodeRay .char{color:#04d}
.CodeRay .char .content{color:#04d}
.CodeRay .char .delimiter{color:#039}
.CodeRay .class{color:#458;font-weight:bold}
.CodeRay .complex{color:#a08}
.CodeRay .constant,.CodeRay .predefined-constant{color:#008080}
.CodeRay .color{color:#099}
.CodeRay .class-variable{color:#369}
.CodeRay .decorator{color:#b0b}
.CodeRay .definition{color:#099}
.CodeRay .delimiter{color:#000}
.CodeRay .doc{color:#970}
.CodeRay .doctype{color:#34b}
.CodeRay .doc-string{color:#d42}
.CodeRay .escape{color:#666}
.CodeRay .entity{color:#800}
.CodeRay .error{color:#808}
.CodeRay .exception{color:inherit}
.CodeRay .filename{color:#099}
.CodeRay .function{color:#900;font-weight:bold}
.CodeRay .global-variable{color:#008080}
.CodeRay .hex{color:#058}
.CodeRay .integer,.CodeRay .float{color:#099}
.CodeRay .include{color:#555}
.CodeRay .inline{color:#000}
.CodeRay .inline .inline{background:#ccc}
.CodeRay .inline .inline .inline{background:#bbb}
.CodeRay .inline .inline-delimiter{color:#d14}
.CodeRay .inline-delimiter{color:#d14}
.CodeRay .important{color:#555;font-weight:bold}
.CodeRay .interpreted{color:#b2b}
.CodeRay .instance-variable{color:#008080}
.CodeRay .label{color:#970}
.CodeRay .local-variable{color:#963}
.CodeRay .octal{color:#40e}
.CodeRay .predefined{color:#369}
.CodeRay .preprocessor{color:#579}
.CodeRay .pseudo-class{color:#555}
.CodeRay .directive{font-weight:bold}
.CodeRay .type{font-weight:bold}
.CodeRay .predefined-type{color:inherit}
.CodeRay .reserved,.CodeRay .keyword {color:#000;font-weight:bold}
.CodeRay .key{color:#808}
.CodeRay .key .delimiter{color:#606}
.CodeRay .key .char{color:#80f}
.CodeRay .value{color:#088}
.CodeRay .regexp .delimiter{color:#808}
.CodeRay .regexp .content{color:#808}
.CodeRay .regexp .modifier{color:#808}
.CodeRay .regexp .char{color:#d14}
.CodeRay .regexp .function{color:#404;font-weight:bold}
.CodeRay .string{color:#d20}
.CodeRay .string .string .string{background:#ffd0d0}
.CodeRay .string .content{color:#d14}
.CodeRay .string .char{color:#d14}
.CodeRay .string .delimiter{color:#d14}
.CodeRay .shell{color:#d14}
.CodeRay .shell .delimiter{color:#d14}
.CodeRay .symbol{color:#990073}
.CodeRay .symbol .content{color:#a60}
.CodeRay .symbol .delimiter{color:#630}
.CodeRay .tag{color:#008080}
.CodeRay .tag-special{color:#d70}
.CodeRay .variable{color:#036}
.CodeRay .insert{background:#afa}
.CodeRay .delete{background:#faa}
.CodeRay .change{color:#aaf;background:#007}
.CodeRay .head{color:#f8f;background:#505}
.CodeRay .insert .insert{color:#080}
.CodeRay .delete .delete{color:#800}
.CodeRay .change .change{color:#66f}
.CodeRay .head .head{color:#f4f}
</style>
</head>
<body class="article">
<div id="header">
<div id="toc" class="toc">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_more_performance">1. More Performance</a>
<ul class="sectlevel2">
<li><a href="#_calling_assembly_from_c">1.1. Calling Assembly from C</a></li>
<li><a href="#_returning_a_value_from_assembly">1.2. Returning a Value from Assembly</a></li>
<li><a href="#_using_the_built_in_counter_for_timing">1.3. Using the Built-In Counter for Timing</a></li>
<li><a href="#_xout_and_xin_transfering_between_prus">1.4. Xout and Xin - Transfering Between PRUs</a></li>
<li><a href="#_copyright">1.5. Copyright</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div class="paragraph">
<p><a href="../index.html">Outline</a></p>
</div>
<div class="sect1">
<h2 id="_more_performance"><a class="link" href="#_more_performance">1. More Performance</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>So far in all our examples we&#8217;ve been able to meet our timing goals by writing
our code in the C programming language. The C compiler does a suprisingly
good job at generating code, most the time.  However there are times
when very precise timing is needed and the compiler isn&#8217;t doing it.</p>
</div>
<div class="paragraph">
<p>At these times you need to write in assembly language.  This chapter
introduces the PRU assembler and shows how to call assembly code from
C. Detailing on how to program in assembly are beyond the scope of this text.</p>
</div>
<div class="paragraph">
<p>The following are resources used in this chapter.</p>
</div>
<div class="ulist">
<div class="title">Resources</div>
<ul>
<li>
<p><a href="http://www.ti.com/lit/ug/spruhv7b/spruhv7b.pdf">PRU Optimizing C/C++ Compiler, v2.2, User&#8217;s Guide</a></p>
</li>
<li>
<p><a href="http://www.ti.com/lit/ug/spruhv6b/spruhv6b.pdf">PRU Assembly Language Tools User&#8217;s Guide</a></p>
</li>
<li>
<p><a href="http://www.ti.com/lit/ug/spruij2/spruij2.pdf">PRU Assembly Instruction User Guide</a></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_calling_assembly_from_c"><a class="link" href="#_calling_assembly_from_c">1.1. Calling Assembly from C</a></h3>
<div class="sect3">
<h4 id="_problem"><a class="link" href="#_problem">Problem</a></h4>
<div class="paragraph">
<p>You have some C code and you want to call an assembly language routine from
it.</p>
</div>
</div>
<div class="sect3">
<h4 id="_solution"><a class="link" href="#_solution">Solution</a></h4>
<div class="paragraph">
<p>You need to do two things, write the assembler file and modify the <code>Makefile</code>
to include it. For example, let&#8217;s write our own <code>my_delay_cycles</code> routine in
in assembly.  The intrinsic <code>__delay_cycles</code> must be passed a compile time
constant.  Our new <code>delay_cycles</code> can take a runtime delay value.</p>
</div>
<div class="paragraph">
<p><a href="#more_delay-test">delay-test.pru0.c</a> is much like our other c code, but on line 10 we declare
<code>my_delay_cycles</code> and then on lines 24 and 26 we&#8217;ll call it with an argument
of 1.</p>
</div>
<div id="more_delay-test" class="listingblock">
<div class="title">delay-test.pru0.c</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="c"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
</pre></td>
  <td class="code"><pre><span class="comment">// Shows how to call an assembly routine with one parameter</span>
<span class="preprocessor">#include</span> <span class="include">&lt;stdint.h&gt;</span>
<span class="preprocessor">#include</span> <span class="include">&lt;pru_cfg.h&gt;</span>
<span class="preprocessor">#include</span> <span class="include">&quot;resource_table_empty.h&quot;</span>
<span class="preprocessor">#include</span> <span class="include">&quot;prugpio.h&quot;</span>

<span class="comment">// The function is defined in delay.asm in same dir</span>
<span class="comment">// We just need to add a declaration here, the defination can be</span>
<span class="comment">// seperately linked</span>
<span class="directive">extern</span> <span class="directive">void</span> my_delay_cycles(uint32_t);

<span class="directive">volatile</span> <span class="directive">register</span> uint32_t <em>R30;
<span class="directive">volatile</span> <span class="directive">register</span> uint32_t </em>R31;

<span class="directive">void</span> main(<span class="directive">void</span>)
{
    uint32_t gpio = P9_31;  <span class="comment">// Select which pin to toggle.;</span>

    <span class="comment">/* Clear SYSCFG[STANDBY_INIT] to enable OCP master port */</span>
    CT_CFG.SYSCFG_bit.STANDBY_INIT = <span class="integer">0</span>;

    <span class="keyword">while</span>(<span class="integer">1</span>) {
        <em>R30 |= gpio;      <span class="comment">// Set the GPIO pin to 1</span>
        my_delay_cycles(<span class="integer">1</span>);
        </em>R30 &amp;= ~gpio;     <span class="comment">// Clear the GPIO pin</span>
        my_delay_cycles(<span class="integer">1</span>);
    }
}</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="#more_delay">delay.pru0.asm</a> is the assembly code.</p>
</div>
<div id="more_delay" class="listingblock">
<div class="title">delay.pru0.asm</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="c"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
</pre></td>
  <td class="code"><pre>; This is an example of how to call an assembly routine from C.
;   Mark A. Yoder, <span class="integer">9</span>-July-<span class="integer">2018</span>
    .global my_delay_cycles
my_delay_cycles:
delay:
    sub     r14,   r14, <span class="integer">1</span>       ; The first argument is passed in r14
    qbne    delay, r14, <span class="integer">0</span>

    jmp     r3.w2           ; r3 contains the <span class="keyword">return</span> address</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>Makefile</code> has one addition that needs to be made to compile both <a href="#more_delay-test">delay-test.pru0.c</a>
and <a href="#more_delay">delay.pru0.asm</a>.
If you look in the local <code>Makefile</code> you&#8217;ll see:</p>
</div>
<div id="more_makefile" class="listingblock">
<div class="title">Makefile</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="makefile">include /var/lib/cloud9/common/Makefile</code></pre>
</div>
</div>
<div class="paragraph">
<p>This Makefle includes a common Makfile at  <code>/var/lib/cloud9/common/Makefile</code>,
this the Makefile you need to edit.
Edit <code>/var/lib/cloud9/common/Makefile</code> and go to line 195.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="makefile">$(GEN_DIR)/%.out: $(GEN_DIR)/%.o <strong>$(GEN_DIR)/$(TARGETasm).o</strong>
    @mkdir -p $(GEN_DIR)
    @echo 'LD   $^'
    $(eval $(call target-to-proc,$@))
    $(eval $(call proc-to-build-vars,$@))
    @$(LD) $@ $^ $(LDFLAGS)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Add <code><strong>(GEN_DIR)/$(TARGETasm).o</strong></code> as shown in bold above.  You will want to remove
this addition once you are done with this example since it will break the other examples.</p>
</div>
<div class="paragraph">
<p>The following will compile and run everything.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">bone$ <strong>config-pin P9_31 pruout</strong>
bone$ <strong>make TARGET=delay-test.pru0 TARGETasm=delay.pru0</strong>
/var/lib/cloud9/common/Makefile:29: MODEL=TI_AM335x_BeagleBone_Black,TARGET=delay-test.pru0
-    Stopping PRU 0
-   copying firmware file /tmp/cloud9-examples/delay-test.pru0.out to /lib/firmware/am335x-pru0-fw
write_init_pins.sh
-    Starting PRU 0
MODEL   = TI_AM335x_BeagleBone_Black
PROC    = pru
PRUN    = 0
PRU_DIR = /sys/class/remoteproc/remoteproc1</code></pre>
</div>
</div>
<div class="paragraph">
<p>The resulting output is shown in <a href="#more_my_delay_cycles">Output of my_delay_cycles()</a>.</p>
</div>
<div id="more_my_delay_cycles" class="paragraph">
<div class="title">Output of my_delay_cycles()</div>
<p><span class="image"><img src="figures/my_delay_cycles.png" alt="Output of my_delay_cycles()"></span></p>
</div>
<div class="paragraph">
<p>Notice the on time is about 35ns and the off time is 30ns.</p>
</div>
</div>
<div class="sect3">
<h4 id="_discission"><a class="link" href="#_discission">Discission</a></h4>
<div class="paragraph">
<p>There is much to explain here.  Let&#8217;s start with <a href="#more_delay">delay.pru0.asm</a>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Line-by-line of delay.pru0.asm</caption>
<colgroup>
<col style="width: 10%;">
<col style="width: 90%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Line</th>
<th class="tableblock halign-left valign-top">Explanation</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Declare <code>my_delay_cycles</code> to be global so the linker can find it.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Label the starting point for <code>my_delay_cycles</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Label for our delay loop.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The first argument is passed in register <code>r14</code>.  Page 111 of
<a href="http://www.ti.com/lit/ug/spruhv7b/spruhv7b.pdf">PRU Optimizing C/C++ Compiler, v2.2, User&#8217;s Guide</a>
gives the argument passing convention.  Registers <code>r14</code> to <code>r29</code> are used
to pass arguments, if there are more arguments, the argument stack (<code>r4</code>)
is used.  The other register conventions are found on page 108.</p>
<p class="tableblock">Here we subtract 1 from <code>r14</code> and save it back into <code>r14</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>qbne</code> is a quick branch if not equal.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">9</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Once we&#8217;ve delayed enough we drop through the quick branch and
hit the jump.  The upper bits of register <code>r3</code> has the return address,
therefore we return to the c code.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><a href="#more_my_delay_cycles">Output of my_delay_cycles()</a> shows the <em>on</em> time is 35ns and the off time is 30ns.
With 5ns/cycle this gives 7 cycles on and 6 off. These times make sense
because each instruction takes a cycle and you have, set <code>R30</code>, jump to
<code>my_delay_cycles</code>, <code>sub</code>, <code>qbne</code>, <code>jmp</code>. Plus the instruction (not seen) that
initilizes <code>r14</code> to the passed value.  That&#8217;s a total of six instructions.
The extra instruction is the branch at the bottom of the <code>while</code> loop.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_returning_a_value_from_assembly"><a class="link" href="#_returning_a_value_from_assembly">1.2. Returning a Value from Assembly</a></h3>
<div class="sect3">
<h4 id="_problem_2"><a class="link" href="#_problem_2">Problem</a></h4>
<div class="paragraph">
<p>Your assembly code needs to return a value.</p>
</div>
</div>
<div class="sect3">
<h4 id="_solution_2"><a class="link" href="#_solution_2">Solution</a></h4>
<div class="paragraph">
<p><code>R14</code> is how the return value is passed back.  <a href="#more_test2">delay-test2.pru0.c</a> shows the c
code.</p>
</div>
<div id="more_test2" class="listingblock">
<div class="title">delay-test2.pru0.c</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="c"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
</pre></td>
  <td class="code"><pre><span class="comment">// Shows how to call an assembly routine with a return value</span>
<span class="preprocessor">#include</span> <span class="include">&lt;stdint.h&gt;</span>
<span class="preprocessor">#include</span> <span class="include">&lt;pru_cfg.h&gt;</span>
<span class="preprocessor">#include</span> <span class="include">&quot;resource_table_empty.h&quot;</span>
<span class="preprocessor">#include</span> <span class="include">&quot;prugpio.h&quot;</span>

<span class="preprocessor">#define</span> TEST    <span class="integer">100</span>

<span class="comment">// The function is defined in delay.asm in same dir</span>
<span class="comment">// We just need to add a declaration here, the defination can be</span>
<span class="comment">// seperately linked</span>
<span class="directive">extern</span> uint32_t my_delay_cycles(uint32_t);

uint32_t ret;

<span class="directive">volatile</span> <span class="directive">register</span> uint32_t <em>R30;
<span class="directive">volatile</span> <span class="directive">register</span> uint32_t </em>R31;

<span class="directive">void</span> main(<span class="directive">void</span>)
{
    uint32_t gpio = P9_31;  <span class="comment">// Select which pin to toggle.;</span>

    <span class="comment">/* Clear SYSCFG[STANDBY_INIT] to enable OCP master port */</span>
    CT_CFG.SYSCFG_bit.STANDBY_INIT = <span class="integer">0</span>;

    <span class="keyword">while</span>(<span class="integer">1</span>) {
        <em>R30 |= gpio;      <span class="comment">// Set the GPIO pin to 1</span>
        ret = my_delay_cycles(<span class="integer">1</span>);
        </em>R30 &amp;= ~gpio;     <span class="comment">// Clear the GPIO pin</span>
        ret = my_delay_cycles(<span class="integer">1</span>);
    }
}</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="#more_delay2">delay2.pru0.asm</a> is the assembly code.</p>
</div>
<div id="more_delay2" class="listingblock">
<div class="title">delay2.pru0.asm</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="c"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre></td>
  <td class="code"><pre>; This is an example of how to call an assembly routine from C with a retun value.
;   Mark A. Yoder, <span class="integer">9</span>-July-<span class="integer">2018</span>

    .cdecls <span class="string"><span class="delimiter">&quot;</span><span class="content">delay-test2.pru0.c</span><span class="delimiter">&quot;</span></span>

    .global my_delay_cycles
my_delay_cycles:
delay:
    sub     r14,   r14, <span class="integer">1</span>       ; The first argument is passed in r14
    qbne    delay, r14, <span class="integer">0</span>

    ldi     r14, TEST       ; TEST is defined in delay-test2.c
                            ; r14 is the <span class="keyword">return</span> <span class="directive">register</span>

    jmp     r3.w2           ; r3 contains the <span class="keyword">return</span> address</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>An additional feature is shown in line 4 of <a href="#more_delay2">delay2.pru0.asm</a>.  The
<code>.cdecls "delay-test2.pru0.c"</code> says to include any defines from <code>delay-test2.pru0.c</code>
In this example, line 6 of <a href="#more_test2">delay-test2.pru0.c</a> <code>#defines</code> TEST and line 12 of
<a href="#more_delay2">delay2.pru0.asm</a> reference it.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_using_the_built_in_counter_for_timing"><a class="link" href="#_using_the_built_in_counter_for_timing">1.3. Using the Built-In Counter for Timing</a></h3>
<div class="sect3">
<h4 id="_problem_3"><a class="link" href="#_problem_3">Problem</a></h4>
<div class="paragraph">
<p>I want to count how many cycles my routine takes.</p>
</div>
</div>
<div class="sect3">
<h4 id="_solution_3"><a class="link" href="#_solution_3">Solution</a></h4>
<div class="paragraph">
<p>Each PRU has a <code>CYCLE</code> register which counts the number of cycles since
the PRU was enabled. They also have a <code>STALL</code> register that counts how
many times the PRU stalled fetching an instruction.
<a href="#more_cycle">cycle.pru0.c - Code to count cycles.</a> shows they are used.</p>
</div>
<div id="more_cycle" class="listingblock">
<div class="title">cycle.pru0.c - Code to count cycles.</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="c"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
</pre></td>
  <td class="code"><pre><span class="comment">// Access the CYCLE and STALL registers</span>
<span class="preprocessor">#include</span> <span class="include">&lt;stdint.h&gt;</span>
<span class="preprocessor">#include</span> <span class="include">&lt;pru_cfg.h&gt;</span>
<span class="preprocessor">#include</span> <span class="include">&lt;pru_ctrl.h&gt;</span>
<span class="preprocessor">#include</span> <span class="include">&quot;resource_table_empty.h&quot;</span>
<span class="preprocessor">#include</span> <span class="include">&quot;prugpio.h&quot;</span>

<span class="directive">volatile</span> <span class="directive">register</span> uint32_t <em>R30;
<span class="directive">volatile</span> <span class="directive">register</span> uint32_t </em>R31;

<span class="directive">void</span> main(<span class="directive">void</span>)
{
    uint32_t gpio = P9_31;  <span class="comment">// Select which pin to toggle.;</span>

    <span class="comment">// These will be kept in registers and never witten to DRAM</span>
    uint32_t cycle, stall;

    <span class="comment">// Clear SYSCFG[STANDBY_INIT] to enable OCP master port</span>
    CT_CFG.SYSCFG_bit.STANDBY_INIT = <span class="integer">0</span>;

    PRU0_CTRL.CTRL_bit.CTR_EN = <span class="integer">1</span>;  <span class="comment">// Enable cycle counter</span>

    <em>R30 |= gpio;              <span class="comment">// Set the GPIO pin to 1</span>
    <span class="comment">// Reset cycle counter, cycle is on the right side to force the compiler</span>
    <span class="comment">// to put it in it's own register</span>
    PRU0_CTRL.CYCLE = cycle;
    </em>R30 &amp;= ~gpio;             <span class="comment">// Clear the GPIO pin</span>
    cycle = PRU0_CTRL.CYCLE;    <span class="comment">// Read cycle and store in a register</span>
    stall = PRU0_CTRL.STALL;    <span class="comment">// Ditto for stall</span>

    __halt();
}</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_discission_2"><a class="link" href="#_discission_2">Discission</a></h4>
<div class="paragraph">
<p>The code is mostly the same as other examples.
<code>cycle</code> and <code>stall</code> end up in registers which
we can read using prudebug.
<a href="#more_cycle_lines">Line-by-line for cycle.pru0.c</a> is the Line-by-line.</p>
</div>
<table id="more_cycle_lines" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 2. Line-by-line for cycle.pru0.c</caption>
<colgroup>
<col style="width: 10%;">
<col style="width: 90%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Line</th>
<th class="tableblock halign-left valign-top">Explanation</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Include needed to reference <code>CYCLE</code> and <code>STALL</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">16</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Declaring <code>cycle</code> and <code>stall</code>.  The compiler will optimize these and just
keep them in registers.  We&#8217;ll have to look at the <code>cycle.pru0.lst</code> file to see where
they are stored.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">21</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enables <code>CYCLE</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">26</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reset <code>CYCLE</code>. It ignores the value assigned to it and always sets it
to 0.  <code>cycle</code> is on the right hand side to make the compiler give it it&#8217;s own
register.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">28, 29</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reads the <code>CYCLE</code> and <code>STALL</code> values into registers.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>You can see where <code>cycle</code> and <code>stall</code> are stored by looking into
<a href="#more_cycle_list0">/tmp/cloud9-examples/cycle.pru0.lst Lines 113..119</a>.</p>
</div>
<div id="more_cycle_list0" class="listingblock">
<div class="title">/tmp/cloud9-examples/cycle.pru0.lst Lines 113..119</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="asm"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
</pre></td>
  <td class="code"><pre>     103;----------------------------------------------------------------------
     104;  23 | PRU0_CTRL.CTRL_bit.CTR_EN = 1;  // Enable cycle counter
     105;----------------------------------------------------------------------
     106 0000000c 200080240002C0          LDI32     r0, 0x00022000        ; [ALU_PRU] |23| $O$C1
     107 00000014 000000F1002081          LBBO      &amp;r1, r0, 0, 4         ; [ALU_PRU] |23|
     108 00000018 0000001F03E1E1          SET       r1, r1, 0x00000003    ; [ALU_PRU] |23|
     109 0000001c 000000E1002081          SBBO      &amp;r1, r0, 0, 4         ; [ALU_PRU] |23|</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Here the <code>LDI32</code> instruction loads the address <code>0x22000</code> into <code>r0</code>.
This is the offset to the <code>CTRL</code> registers.
 Later in the file we see <a href="#more_cycle_list1">/tmp/cloud9-examples/cycle.pru0.lst Lines 146..152</a>.</p>
</div>
<div id="more_cycle_list1" class="listingblock">
<div class="title">/tmp/cloud9-examples/cycle.pru0.lst Lines 146..152</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="asm"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
</pre></td>
  <td class="code"><pre>     131;----------------------------------------------------------------------
     132 0000002c 000000F10C2081          LBBO      &amp;r1, r0, 12, 4        ; [ALU_PRU] |30| $O$C1
     133        .dwpsn  file &quot;cycle.pru0.c&quot;,line 31,column 2,is_stmt,isa 0
     134;----------------------------------------------------------------------
     135;  31 | stall = PRU0_CTRL.STALL;        // Ditto for stall
     136;----------------------------------------------------------------------
     137 00000030 000000F1102080          LBBO      &amp;r0, r0, 16, 4        ; [ALU_PRU] |31| $O$C1</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>The first <code>LBBO</code> takes the contents of <code>r0</code> and adds the offset 12 to it and
copies 4 bytes into <code>r1</code>.  This points to <code>CYCLE</code>, so <code>r1</code> has the contents of
<code>CYCLE</code>.</p>
</div>
<div class="paragraph">
<p>The second <code>LBBO</code> does the same, but with offset 16, which points to <code>STALL</code>,
thus <code>STALL</code> is now  in <code>r0</code>.</p>
</div>
<div class="paragraph">
<p>Now fire up prudebug and look at those registers.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">bone$ <strong>sudo prudebug</strong>
PRU0&gt; <strong>r</strong>
r
r
Register info for PRU0
    Control register: 0x00000009
      Reset PC:0x0000  STOPPED, FREE_RUN, COUNTER_ENABLED, NOT_SLEEPING, PROC_DISABLED

    Program counter: 0x0012
      Current instruction: HALT

    R00: <strong>0x00000005</strong>    R08: 0x00000200    R16: 0x000003c6    R24: 0x00110210
    R01: <strong>0x00000003</strong>    R09: 0x00000000    R17: 0x00000000    R25: 0x00000000
    R02: 0x000000fc    R10: 0xfff4ea57    R18: 0x000003e6    R26: 0x6e616843
    R03: 0x0004272c    R11: 0x5fac6373    R19: 0x30203020    R27: 0x206c656e
    R04: 0xffffffff    R12: 0x59bfeafc    R20: 0x0000000a    R28: 0x00003033
    R05: 0x00000007    R13: 0xa4c19eaf    R21: 0x00757270    R29: 0x02100000
    R06: 0xefd30a00    R14: 0x00000005    R22: 0x0000001e    R30: 0xa03f9990
    R07: 0x00020024    R15: 0x00000003    R23: 0x00000000    R31: 0x00000000</code></pre>
</div>
</div>
<div class="paragraph">
<p>So <code>cycle</code> is 3 and <code>stall</code> is 5. It must be one cycle to clear the GPIO
and 2 cycles to read the <code>CYCLE</code> register and save it in the register.
It&#8217;s interesting there are 5 <code>stall</code> cycles.</p>
</div>
<div class="paragraph">
<p>If you switch the order of
lines 30 and 31 you&#8217;ll see <code>cycle</code> is 7 and <code>stall</code> is 2. <code>cycle</code> now
includes the time needed to read <code>stall</code> and <code>stall</code> no longer includes
the time to read <code>cycle</code>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_xout_and_xin_transfering_between_prus"><a class="link" href="#_xout_and_xin_transfering_between_prus">1.4. Xout and Xin - Transfering Between PRUs</a></h3>
<div class="sect3">
<h4 id="_problem_4"><a class="link" href="#_problem_4">Problem</a></h4>
<div class="paragraph">
<p>I need to transfer data between PRUs quickly.</p>
</div>
</div>
<div class="sect3">
<h4 id="_solution_4"><a class="link" href="#_solution_4">Solution</a></h4>
<div class="paragraph">
<p>The <code>__xout()</code> and <code>__xin()</code> intrinsics are able to transfer up to 30 registers between
PRU 0 and PRU 1 quickly.  <a href="#more_xout">xout.pru0.c</a> shows how <code>xout()</code> running on PRU 0
transfers six registers to PRU 1.</p>
</div>
<div id="more_xout" class="listingblock">
<div class="title">xout.pru0.c</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="c"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
</pre></td>
  <td class="code"><pre><span class="comment">// From: http://git.ti.com/pru-software-support-package/pru-software-support-package/trees/master/examples/am335x/PRU_Direct_Connect0</span>
<span class="preprocessor">#include</span> <span class="include">&lt;stdint.h&gt;</span>
<span class="preprocessor">#include</span> <span class="include">&lt;pru_intc.h&gt;</span>
<span class="preprocessor">#include</span> <span class="include">&quot;resource_table_pru0.h&quot;</span>

<span class="directive">volatile</span> <span class="directive">register</span> uint32_t <em>R30;
<span class="directive">volatile</span> <span class="directive">register</span> uint32_t </em>R31;

<span class="keyword">typedef</span> <span class="keyword">struct</span> {
    uint32_t reg5;
    uint32_t reg6;
    uint32_t reg7;
    uint32_t reg8;
    uint32_t reg9;
    uint32_t reg10;
} bufferData;

bufferData dmemBuf;

<span class="comment">/* PRU-to-ARM interrupt <strong>/</span>
<span class="preprocessor">#define</span> PRU1_PRU0_INTERRUPT (<span class="integer">18</span>)
<span class="preprocessor">#define</span> PRU0_ARM_INTERRUPT (<span class="integer">19</span>+<span class="integer">16</span>)

<span class="directive">void</span> main(<span class="directive">void</span>)
{
    <span class="comment">/</strong> Clear the status of all interrupts <strong>/</span>
    CT_INTC.SECR0 = <span class="hex">0xFFFFFFFF</span>;
    CT_INTC.SECR1 = <span class="hex">0xFFFFFFFF</span>;

    <span class="comment">/</strong> Load the buffer with default values to transfer <strong>/</span>
    dmemBuf.reg5 = <span class="hex">0xDEADBEEF</span>;
    dmemBuf.reg6 = <span class="hex">0xAAAAAAAA</span>;
    dmemBuf.reg7 = <span class="hex">0x12345678</span>;
    dmemBuf.reg8 = <span class="hex">0xBBBBBBBB</span>;
    dmemBuf.reg9 = <span class="hex">0x87654321</span>;
    dmemBuf.reg10 = <span class="hex">0xCCCCCCCC</span>;

    <span class="comment">/</strong> Poll until R31.30 (PRU0 interrupt) is set
     * This signals PRU1 is initialized <strong>/</span>
    <span class="keyword">while</span> ((<em>R31 &amp; (<span class="integer">1</span>&lt;&lt;<span class="integer">30</span>)) == <span class="integer">0</span>) {
    }

    <span class="comment">/</strong> XFR registers R5-R10 from PRU0 to PRU1 <strong>/</span>
    <span class="comment">/</strong> 14 is the device_id that signifies a PRU to PRU transfer <strong>/</span>
    </em>xout(<span class="integer">14</span>, <span class="integer">5</span>, <span class="integer">0</span>, dmemBuf);

    <span class="comment">/</strong> Clear the status of the interrupt <strong>/</span>
    CT_INTC.SICR = PRU1_PRU0_INTERRUPT;

    <span class="comment">/</strong> Halt the PRU core */</span>
    __halt();
}</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>PRU 1 waits at line 41 until PRU 0 signals it.  <a href="#more_xin">xin.pru1.c</a> sends sends an
interupt to PRU 0 and waits for it to send the data.</p>
</div>
<div id="more_xin" class="listingblock">
<div class="title">xin.pru1.c</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="c"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
</pre></td>
  <td class="code"><pre><span class="comment">// From: http://git.ti.com/pru-software-support-package/pru-software-support-package/trees/master/examples/am335x/PRU_Direct_Connect1</span>
<span class="preprocessor">#include</span> <span class="include">&lt;stdint.h&gt;</span>
<span class="preprocessor">#include</span> <span class="include">&quot;resource_table_empty.h&quot;</span>

<span class="directive">volatile</span> <span class="directive">register</span> uint32_t <em>R30;
<span class="directive">volatile</span> <span class="directive">register</span> uint32_t </em>R31;

<span class="keyword">typedef</span> <span class="keyword">struct</span> {
    uint32_t reg5;
    uint32_t reg6;
    uint32_t reg7;
    uint32_t reg8;
    uint32_t reg9;
    uint32_t reg10;
} bufferData;

bufferData dmemBuf;

<span class="comment">/* PRU-to-ARM interrupt <strong>/</span>
<span class="preprocessor">#define</span> PRU1_PRU0_INTERRUPT (<span class="integer">18</span>)
<span class="preprocessor">#define</span> PRU1_ARM_INTERRUPT (<span class="integer">20</span>+<span class="integer">16</span>)

<span class="directive">void</span> main(<span class="directive">void</span>)
{
    <span class="comment">/</strong> Let PRU0 know that I am awake <strong>/</span>
    <em>R31 = PRU1_PRU0_INTERRUPT+<span class="integer">16</span>;

    <span class="comment">/</strong> XFR registers R5-R10 from PRU0 to PRU1 <strong>/</span>
    <span class="comment">/</strong> 14 is the device_id that signifies a PRU to PRU transfer <strong>/</span>
    </em>xin(<span class="integer">14</span>, <span class="integer">5</span>, <span class="integer">0</span>, dmemBuf);

    <span class="comment">/</strong> Halt the PRU core */</span>
    __halt();
}</pre></td>
</tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Use <code>prudebug</code> to see registers R5-R10 are transfered from PRU 0 to PRU 1.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="c"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
</pre></td>
  <td class="code"><pre>PRU0&gt; <strong>r</strong>
Register info <span class="keyword">for</span> PRU0
    Control <span class="directive">register</span>: <span class="hex">0x00000001</span>
      Reset PC:<span class="hex">0x0000</span>  STOPPED, FREE_RUN, COUNTER_DISABLED, NOT_SLEEPING, PROC_DISABLED

    Program counter: <span class="hex">0x0026</span>
      Current instruction: HALT

    R00: <span class="hex">0x00000012</span>    <strong>R08: <span class="hex">0xbbbbbbbb</span></strong>    R16: <span class="hex">0x000003c6</span>    R24: <span class="hex">0x00110210</span>
    R01: <span class="hex">0x00020000</span>    <strong>R09: <span class="hex">0x87654321</span></strong>    R17: <span class="hex">0x00000000</span>    R25: <span class="hex">0x00000000</span>
    R02: <span class="hex">0x000000e4</span>    <strong>R10: <span class="hex">0xcccccccc</span></strong>    R18: <span class="hex">0x000003e6</span>    R26: <span class="hex">0x6e616843</span>
    R03: <span class="hex">0x0004272c</span>    R11: <span class="hex">0x5fac6373</span>    R19: <span class="hex">0x30203020</span>    R27: <span class="hex">0x206c656e</span>
    R04: <span class="hex">0xffffffff</span>    R12: <span class="hex">0x59bfeafc</span>    R20: <span class="hex">0x0000000a</span>    R28: <span class="hex">0x00003033</span>
    <strong>R05: <span class="hex">0xdeadbeef</span></strong>    R13: <span class="hex">0xa4c19eaf</span>    R21: <span class="hex">0x00757270</span>    R29: <span class="hex">0x02100000</span>
    <strong>R06: <span class="hex">0xaaaaaaaa</span></strong>    R14: <span class="hex">0x00000005</span>    R22: <span class="hex">0x0000001e</span>    R30: <span class="hex">0xa03f9990</span>
    <strong>R07: <span class="hex">0x12345678</span></strong>    R15: <span class="hex">0x00000003</span>    R23: <span class="hex">0x00000000</span>    R31: <span class="hex">0x00000000</span>

PRU0&gt; <strong>pru <span class="integer">1</span></strong>
pru <span class="integer">1</span>
Active PRU is PRU1.

PRU1&gt; <strong>r</strong>
r
Register info <span class="keyword">for</span> PRU1
    Control <span class="directive">register</span>: <span class="hex">0x00000001</span>
      Reset PC:<span class="hex">0x0000</span>  STOPPED, FREE_RUN, COUNTER_DISABLED, NOT_SLEEPING, PROC_DISABLED

    Program counter: <span class="hex">0x000b</span>
      Current instruction: HALT

    R00: <span class="hex">0x00000100</span>    <strong>R08: <span class="hex">0xbbbbbbbb</span></strong>    R16: <span class="hex">0xe9da228b</span>    R24: <span class="hex">0x28113189</span>
    R01: <span class="hex">0xe48cdb1f</span>    <strong>R09: <span class="hex">0x87654321</span></strong>    R17: <span class="hex">0x66621777</span>    R25: <span class="hex">0xddd29ab1</span>
    R02: <span class="hex">0x000000e4</span>    <strong>R10: <span class="hex">0xcccccccc</span></strong>    R18: <span class="hex">0x661f83ea</span>    R26: <span class="hex">0xcf1cd4a5</span>
    R03: <span class="hex">0x0004db97</span>    R11: <span class="hex">0xdec387d5</span>    R19: <span class="hex">0xa85adb78</span>    R27: <span class="hex">0x70af2d02</span>
    R04: <span class="hex">0xa90e496f</span>    R12: <span class="hex">0xbeac3878</span>    R20: <span class="hex">0x048fff22</span>    R28: <span class="hex">0x7465f5f0</span>
    <strong>R05: <span class="hex">0xdeadbeef</span></strong>    R13: <span class="hex">0x5777b488</span>    R21: <span class="hex">0xa32977c7</span>    R29: <span class="hex">0xae96b530</span>
    <strong>R06: <span class="hex">0xaaaaaaaa</span></strong>    R14: <span class="hex">0xffa60550</span>    R22: <span class="hex">0x99fb123e</span>    R30: <span class="hex">0x52c42a0d</span>
    <strong>R07: <span class="hex">0x12345678</span></strong>    R15: <span class="hex">0xdeb2142d</span>    R23: <span class="hex">0xa353129d</span>    R31: <span class="hex">0x00000000</span>
</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_discussion"><a class="link" href="#_discussion">Discussion</a></h4>
<div class="paragraph">
<p><a href="#more_zout_lines">xout.pru0.c Line-by-line</a> shows the line-by-line for <code>xout.pru0.c</code></p>
</div>
<table id="more_zout_lines" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 3. xout.pru0.c Line-by-line</caption>
<colgroup>
<col style="width: 10%;">
<col style="width: 90%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Line</th>
<th class="tableblock halign-left valign-top">Explanation</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A different resource so PRU 0 can receive a signal from PRU 1.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">9-16</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>dmemBuf</code> holds the data to be sent to PRU 1.  Each will be transfered
to its corresponding register by <code>xout()</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">21-22</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Define the interupts we&#8217;re using.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">27-28</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Clear the interrupts.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">31-36</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Initialize dmemBuf with easy to recognize values.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">40</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Wait for PRU 1 to signal.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">45</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>__xout()</code> does a direct transfer to PRU 1.
Page 92 of
<a href="http://www.ti.com/lit/ug/spruhv7b/spruhv7b.pdf">PRU Optimizing C/C++ Compiler, v2.2, User&#8217;s Guide</a>
shows how to use <code>xout()</code>. The first argument, 14, says to do a direct
transfer to PRU 1.  If the
first argument is 10, 11 or 12, the data is transfered to one of three
scratchpad memories that PRU 1 can access later.</p>
<p class="tableblock">The second argument, 5, says to start transfering
with register <code>r5</code> and use as many regsiters as needed to transfer all of
<code>dmemBuf</code>.</p>
<p class="tableblock">The third argument, 0, says to not use remapping. (See the User&#8217;s Guide for
details.)</p>
<p class="tableblock">The final argument is the data to be transfered.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">48</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Clear the interupt so it can go again.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><a href="#more_xin_lines">xin.pru1.c Line-by-line</a> shows the line-by-line for <code>xin.pru1.c</code>.</p>
</div>
<table id="more_xin_lines" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 4. xin.pru1.c Line-by-line</caption>
<colgroup>
<col style="width: 10%;">
<col style="width: 90%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Line</th>
<th class="tableblock halign-left valign-top">Explanation</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">8-15</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Place to put the received data.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">26</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Signal PRU 0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">30</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Receive the data. The arguments are the same as <code>xout()</code>,
14 says to get the data directly from PRU 0.
5 says to start with register <code>r5</code>.
<code>dmemBuf</code> is where to put the data.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>If you really need speed, considering using <code>__xout()</code> and
<code>__xin()</code> in assembly.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_copyright"><a class="link" href="#_copyright">1.5. Copyright</a></h3>
<div class="listingblock">
<div class="title">copyright.c</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="c"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
</pre></td>
  <td class="code"><pre><span class="comment">/*
 * Copyright (C) 2015 Texas Instruments Incorporated - http://www.ti.com/
 *
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions
 * are met:
 *
 *  * Redistributions of source code must retain the above copyright
 *    notice, this list of conditions and the following disclaimer.
 *
 *  * Redistributions in binary form must reproduce the above copyright
 *    notice, this list of conditions and the following disclaimer in the
 *    documentation and/or other materials provided with the
 *    distribution.
 *
 *  * Neither the name of Texas Instruments Incorporated nor the names of
 *    its contributors may be used to endorse or promote products derived
 *    from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 * &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
 * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */</span>
</pre></td>
</tr></table></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2021-08-04 15:05:18 -0400
</div>
</div>
</body>
</html>